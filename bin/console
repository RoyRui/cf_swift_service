#!/usr/bin/env ruby
# -*- mode: ruby -*-
#
#
ENV["BUNDLE_GEMFILE"] ||= File.expand_path("../../Gemfile", __FILE__)
require 'bundler/setup'
require 'vcap_services_base'

$LOAD_PATH.unshift(File.expand_path("../../lib", __FILE__))
require "swift_service/swift_node"
require 'pry'

def fog_credentials_from_cf_swift_credentials(cf_swift_credentials)
  {
         :provider => 'HP',
         :hp_access_key => cf_swift_credentials["user_name"],
         :hp_secret_key => cf_swift_credentials["password"],
         :hp_tenant_id => cf_swift_credentials["tenant_id"],
         :hp_auth_uri =>  cf_swift_credentials["authentication_uri"],
         :hp_use_upass_auth_style => true,
         :hp_avl_zone => cf_swift_credentials["availability_zone"] || "nova",
         :hp_auth_version => cf_swift_credentials["authentication_version"].to_sym
  }
end

storage_credentials = {"name"=>"41edf347-14b9-4e7f-8875-a969bd63daa0", "authentication_uri"=>"https://auth.hydranodes.de:5000/v2.0/", "user_name"=>"e3e924da-feb2-428d-8f73-dbec45407b9d.swift.user@a9s.eu", "user_id"=>"ca7069f1b60e46cf8ea73856c03f9c81", "password"=>"3LWaugMecKz9pupLRsg3", "tenant_name"=>"41edf347-14b9-4e7f-8875-a969bd63daa0.swift.tenant@a9s.eu", "tenant_id"=>"37cadb87e70941698c35553256e1cec3", "availability_zone"=>"nova", "authentication_version"=>"v2", "account_meta_key"=>"Y84jzzsUi82oCJMHdNbS", "node_id"=>"swift_node_1"}

class FakeLogger
  def debug(msg)
    puts msg
  end
  def info(msg)
    puts msg
  end
  def warn(msg)
    puts msg
  end
  def error(msg)
    puts msg
  end
end

logger = FakeLogger.new
storage = VCAP::Services::Swift::Storage.new(logger, fog_credentials_from_cf_swift_credentials(storage_credentials))

binding.pry